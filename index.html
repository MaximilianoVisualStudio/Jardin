<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="./favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Digital Zen Garden</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18.3.1",
          "react-dom/client": "https://esm.sh/react-dom@18.3.1/client"
        }
      }
    </script>

    <style>
      html {
        background-color: #0f172a; /* fallback */
      }

      /* Fondo primavera */
      body.spring {
        background: linear-gradient(to top, #4ade80 5%, #87ceeb 100%);
        overflow: hidden;
      }

      body.spring::before {
        content: "";
        position: absolute;
        top: -50px;
        left: 50%;
        width: 200px;
        height: 200px;
        margin-left: -100px;
        border-radius: 50%;
        background: #ffe066;
        box-shadow: 0 0 100px 40px #ffd43b88;
        animation: sunGlow 6s ease-in-out infinite alternate;
        z-index: 0;
      }

      @keyframes sunGlow {
        from {
          transform: scale(1);
        }
        to {
          transform: scale(1.1);
        }
      }

      body.spring::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 120px;
        background: linear-gradient(to top, #166534, transparent);
        z-index: 1;
      }

      /* PÃ©talos flotantes realistas */
      .petal {
        position: absolute;
        width: 24px;
        height: 24px;
        opacity: 0.85;
        animation: fall linear infinite;
      }

      .petal svg {
        width: 100%;
        height: 100%;
      }

      @keyframes fall {
        0% {
          transform: translateY(-10vh) rotate(0deg);
          opacity: 0;
        }
        10% {
          opacity: 0.85;
        }
        100% {
          transform: translateY(110vh) rotate(360deg);
          opacity: 0;
        }
      }
    </style>
  </head>
  <body class="spring bg-slate-900">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
      import React, { useState, useEffect, useCallback } from "react";
      import ReactDOM from "react-dom/client";

      const PETAL_COLORS = ["#ffb7c5", "#ffcfe1", "#f3d9fa", "#fff0f6"];
      const CENTER_COLORS = ["#f9ca24", "#fffa65", "#333333"];
      const STEM_COLOR = "#6ab04c";

      const random = (min, max) => Math.random() * (max - min) + min;

      const createEllipsePetals = (numPetals, petalLength, petalWidth, centerSize) => {
        let petalsSvg = "";
        const angleStep = 360 / numPetals;
        for (let i = 0; i < numPetals; i++) {
          const angle = i * angleStep;
          petalsSvg += `<ellipse cx="0" cy="${-(petalLength / 2 + centerSize / 2)}" rx="${
            petalWidth / 2
          }" ry="${petalLength / 2}" transform="rotate(${angle})"/>`;
        }
        return petalsSvg;
      };

      const createPointedPetals = (numPetals, petalLength, petalWidth, centerSize) => {
        let petalsSvg = "";
        const angleStep = 360 / numPetals;
        for (let i = 0; i < numPetals; i++) {
          const angle = i * angleStep;
          const startY = -(centerSize / 2);
          const endY = -(centerSize / 2 + petalLength);
          const controlX = petalWidth;
          petalsSvg += `<path d="M0,${startY} Q${controlX},${
            startY + (endY - startY) / 2
          } 0,${endY} Q${-controlX},${startY + (endY - startY) / 2} 0,${startY} Z" transform="rotate(${angle})"/>`;
        }
        return petalsSvg;
      };

      const petalFunctions = [createEllipsePetals, createPointedPetals];

      const generateFlowerData = () => {
        const petalColor = PETAL_COLORS[Math.floor(random(0, PETAL_COLORS.length))];
        const centerColor = CENTER_COLORS[Math.floor(random(0, CENTER_COLORS.length))];
        const size = random(80, 160);
        const numPetals = Math.floor(random(5, 12));
        const petalLength = size * random(0.25, 0.4);
        const petalWidth = size * random(0.1, 0.22);
        const centerSize = size * random(0.1, 0.2);
        const stemHeight = size * random(0.4, 0.6);
        const stemSway = size * random(-0.15, 0.15);
        const stemWidth = size * random(0.02, 0.04);
        const petalColorOpacity = random(0.7, 1.0);
        const selectedPetalFunc =
          petalFunctions[Math.floor(random(0, petalFunctions.length))];
        const petalsSvg = selectedPetalFunc(numPetals, petalLength, petalWidth, centerSize);
        const viewBoxSize = size;
        const viewboxCenter = viewBoxSize / 2;
        const svgContent = `
          <g transform="translate(${viewboxCenter}, ${viewboxCenter * 0.8})" style="transform-origin: center bottom;">
            <g fill="${petalColor}" opacity="${petalColorOpacity}">${petalsSvg}</g>
            <circle cx="0" cy="0" r="${centerSize / 2}" fill="${centerColor}" />
          </g>
          <path d="M${viewboxCenter} ${viewBoxSize} Q${viewboxCenter + stemSway} ${
          viewBoxSize - stemHeight / 2
        } ${viewboxCenter} ${
          viewBoxSize - stemHeight
        }" stroke="${STEM_COLOR}" stroke-width="${stemWidth}" fill="none" stroke-linecap="round"/>
        `;
        const svg = `<svg width="100%" height="100%" viewBox="0 0 ${viewBoxSize} ${viewBoxSize}" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" style="overflow: visible;">${svgContent}</svg>`;
        return { svg, color: petalColor, size };
      };

      const Flower = ({ flower }) => {
        const [isNew, setIsNew] = useState(true);
        const [isMounted, setIsMounted] = useState(false);

        useEffect(() => {
          const mountTimer = requestAnimationFrame(() => setIsMounted(true));
          const glowTimer = setTimeout(() => setIsNew(false), 2500);
          return () => {
            cancelAnimationFrame(mountTimer);
            clearTimeout(glowTimer);
          };
        }, []);

        const style = {
          color: flower.color,
          transition: "opacity 1s ease-out, transform 1s ease-out, filter 1.5s ease-in-out",
          opacity: isMounted ? 1 : 0,
          transform: isMounted ? "scale(1)" : "scale(0.5)",
          filter: isNew
            ? `drop-shadow(0 0 18px ${flower.color}) drop-shadow(0 0 40px ${flower.color}44)`
            : `drop-shadow(0 0 8px ${flower.color}aa)`,
          willChange: "opacity, transform, filter",
        };

        return (
          <div
            style={style}
            className="w-full h-full transform-gpu"
            dangerouslySetInnerHTML={{ __html: flower.svg }}
          />
        );
      };

      const App = () => {
        const [flowers, setFlowers] = useState([]);

        const handleGrowClick = useCallback(() => {
          const { svg, color, size } = generateFlowerData();
          const newFlower = {
            id: self.crypto.randomUUID(),
            svg,
            color,
            size,
            position: {
              top: `${random(0, 85)}%`,
              left: `${random(0, 95)}%`,
            },
          };
          setFlowers((prevFlowers) => [...prevFlowers, newFlower]);
        }, []);

        // Generar pÃ©talos flotando con SVG mÃ¡s detallado
        const petalSVG = (color) => `
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2 C15 5, 20 10, 12 22 C4 10, 9 5, 12 2Z" fill="${color}"/>
          </svg>
        `;

        const floatingPetals = Array.from({ length: 18 }).map((_, i) => {
          const left = `${random(0, 100)}%`;
          const duration = `${random(10, 20)}s`;
          const delay = `${random(0, 10)}s`;
          const color = PETAL_COLORS[Math.floor(random(0, PETAL_COLORS.length))];
          return (
            <div
              key={i}
              className="petal"
              style={{ left, animationDuration: duration, animationDelay: delay }}
              dangerouslySetInnerHTML={{ __html: petalSVG(color) }}
            ></div>
          );
        });

        return (
          <main className="relative min-h-screen w-full text-slate-100 flex flex-col items-center p-4 overflow-hidden">
            <header className="w-full max-w-4xl text-center py-8 z-20">
              <h1 className="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-400 via-yellow-400 to-green-400">
                JardÃ­n Zen Digital
              </h1>
              <p className="mt-4 text-lg text-slate-800 font-medium">
                Haz clic en 'Crecer' para ver nacer una flor casi tan linda como tÃº.
              </p>
              <p className="mt-6 text-xl font-semibold text-transparent bg-clip-text bg-gradient-to-r from-green-600 via-pink-600 to-yellow-500 animate-pulse">
                ðŸŒ¸ Â¡Feliz DÃ­a de la Primavera, mi amor! ðŸŒ¸
              </p>
            </header>

            <div className="flex-grow w-full flex justify-center my-8 z-20">
              <button
                onClick={handleGrowClick}
                className="bg-pink-500 hover:bg-pink-600 text-white font-bold text-lg rounded-full px-8 py-3 shadow-lg shadow-pink-400/30 hover:shadow-pink-400/50 transition-all duration-300 ease-in-out transform hover:scale-105 active:scale-100"
                aria-label="Cultivar una nueva flor"
              >
                Crecer
              </button>
            </div>

            {/* Flores */}
            <div aria-hidden="true" className="absolute inset-0 w-full h-full z-10 pointer-events-none">
              {flowers.map((flower) => (
                <div
                  key={flower.id}
                  className="absolute"
                  style={{
                    top: flower.position.top,
                    left: flower.position.left,
                    width: `${flower.size}px`,
                    height: `${flower.size}px`,
                  }}
                >
                  <Flower flower={flower} />
                </div>
              ))}
            </div>

            {/* PÃ©talos flotando */}
            <div aria-hidden="true" className="absolute inset-0 w-full h-full z-0 overflow-hidden">
              {floatingPetals}
            </div>
          </main>
        );
      };

      const rootElement = document.getElementById("root");
      const root = ReactDOM.createRoot(rootElement);
      root.render(
        <React.StrictMode>
          <App />
        </React.StrictMode>
      );
    </script>
  </body>
</html>
