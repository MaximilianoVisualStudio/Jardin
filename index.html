<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="./favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Digital Zen Garden</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18.3.1",
          "react-dom/client": "https://esm.sh/react-dom@18.3.1/client"
        }
      }
    </script>

    <style>
      html {
        background-color: #0f172a;
      }

      /* Fondo primavera */
      body.spring {
        background: linear-gradient(to top, #4ade80 5%, #87ceeb 100%);
        overflow: hidden;
      }

      /* Sol más luminoso */
      body.spring::before {
        content: "";
        position: absolute;
        top: -60px;
        left: 50%;
        width: 220px;
        height: 220px;
        margin-left: -110px;
        border-radius: 50%;
        background: radial-gradient(circle at center, #fff8b0 0%, #ffd43b 60%, #ff9f1c 100%);
        box-shadow: 0 0 120px 50px #ffd43b88;
        animation: sunGlow 6s ease-in-out infinite alternate;
        z-index: 0;
      }

      @keyframes sunGlow {
        from {
          transform: scale(1);
        }
        to {
          transform: scale(1.1);
        }
      }

      /* Pasto más vivo */
      body.spring::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 140px;
        background: linear-gradient(to top, #22c55e 40%, #4ade80 80%, transparent);
        z-index: 1;
      }

      /* Pétalos flotantes */
      .petal {
        position: absolute;
        width: 24px;
        height: 24px;
        opacity: 0.85;
        animation: fall linear infinite;
      }

      .petal svg {
        width: 100%;
        height: 100%;
      }

      @keyframes fall {
        0% {
          transform: translateY(-10vh) rotate(0deg);
          opacity: 0;
        }
        10% {
          opacity: 0.85;
        }
        100% {
          transform: translateY(110vh) rotate(360deg);
          opacity: 0;
        }
      }
    </style>
  </head>
  <body class="spring bg-slate-900">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
      import React, { useState, useEffect, useCallback } from "react";
      import ReactDOM from "react-dom/client";

      const PETAL_COLORS = ["#ffb7c5", "#ffcfe1", "#f3d9fa", "#fff0f6"];
      const CENTER_COLORS = ["#f9ca24", "#fffa65", "#333333"];
      const STEM_COLOR = "#6ab04c";

      const random = (min, max) => Math.random() * (max - min) + min;

      const createEllipsePetals = (numPetals, petalLength, petalWidth, centerSize) => {
        let petalsSvg = "";
        const angleStep = 360 / numPetals;
        for (let i = 0; i < numPetals; i++) {
          const angle = i * angleStep;
          petalsSvg += `<ellipse cx="0" cy="${-(petalLength / 2 + centerSize / 2)}" rx="${
            petalWidth / 2
          }" ry="${petalLength / 2}" transform="rotate(${angle})"/>`;
        }
        return petalsSvg;
      };

      const createPointedPetals = (numPetals, petalLength, petalWidth, centerSize) => {
        let petalsSvg = "";
        const angleStep = 360 / numPetals;
        for (let i = 0; i < numPetals; i++) {
          const angle = i * angleStep;
          const startY = -(centerSize / 2);
          const endY = -(centerSize / 2 + petalLength);
          const controlX = petalWidth;
          petalsSvg += `<path d="M0,${startY} Q${controlX},${startY + (endY - startY) / 2} 0,${endY} Q${-controlX},${startY + (endY - startY) / 2} 0,${startY} Z" transform="rotate(${angle})"/>`;
        }
        return petalsSvg;
      };

      // Nueva flor amarilla detallada (reemplaza la rosa)
      const createYellowFlower = (size) => {
        const petalBaseColor = "#fcd34d"; // Amarillo dorado
        const petalLightColor = "#fef08a"; // Amarillo claro
        const centerColor = "#f59e0b"; // Naranja dorado
        const centerDarkColor = "#d97706"; // Naranja oscuro
        
        // Capas de pétalos
        const layers = [];
        
        // Capa 1: Pétalos grandes externos
        const outerPetals = [];
        const outerPetalsCount = 8;
        const outerPetalLength = size * 0.35;
        const outerPetalWidth = size * 0.25;
        
        for (let i = 0; i < outerPetalsCount; i++) {
          const angle = i * (360 / outerPetalsCount);
          const opacity = 0.9 - i * 0.02;
          outerPetals.push(`
            <path d="M0,0 
                     C${outerPetalWidth * 0.7},-${outerPetalLength * 0.3} 
                     ${outerPetalWidth},-${outerPetalLength * 0.7} 
                     0,-${outerPetalLength} 
                     C-${outerPetalWidth},-${outerPetalLength * 0.7} 
                     -${outerPetalWidth * 0.7},-${outerPetalLength * 0.3} 
                     0,0 Z" 
                  transform="rotate(${angle})" 
                  fill="${petalBaseColor}" 
                  opacity="${opacity}" />
          `);
        }
        
        layers.push(`<g>${outerPetals.join('')}</g>`);
        
        // Capa 2: Pétalos medianos
        const middlePetals = [];
        const middlePetalsCount = 8;
        const middlePetalLength = size * 0.28;
        const middlePetalWidth = size * 0.2;
        
        for (let i = 0; i < middlePetalsCount; i++) {
          const angle = i * (360 / middlePetalsCount) + 22.5; // Desplazado
          const opacity = 0.85 - i * 0.02;
          middlePetals.push(`
            <path d="M0,0 
                     C${middlePetalWidth * 0.7},-${middlePetalLength * 0.3} 
                     ${middlePetalWidth},-${middlePetalLength * 0.7} 
                     0,-${middlePetalLength} 
                     C-${middlePetalWidth},-${middlePetalLength * 0.7} 
                     -${middlePetalWidth * 0.7},-${middlePetalLength * 0.3} 
                     0,0 Z" 
                  transform="rotate(${angle})" 
                  fill="${petalLightColor}" 
                  opacity="${opacity}" />
          `);
        }
        
        layers.push(`<g>${middlePetals.join('')}</g>`);
        
        // Capa 3: Pétalos pequeños internos
        const innerPetals = [];
        const innerPetalsCount = 8;
        const innerPetalLength = size * 0.2;
        const innerPetalWidth = size * 0.15;
        
        for (let i = 0; i < innerPetalsCount; i++) {
          const angle = i * (360 / innerPetalsCount);
          const opacity = 0.8 - i * 0.02;
          innerPetals.push(`
            <path d="M0,0 
                     C${innerPetalWidth * 0.7},-${innerPetalLength * 0.3} 
                     ${innerPetalWidth},-${innerPetalLength * 0.7} 
                     0,-${innerPetalLength} 
                     C-${innerPetalWidth},-${innerPetalLength * 0.7} 
                     -${innerPetalWidth * 0.7},-${innerPetalLength * 0.3} 
                     0,0 Z" 
                  transform="rotate(${angle})" 
                  fill="${petalBaseColor}" 
                  opacity="${opacity}" />
          `);
        }
        
        layers.push(`<g>${innerPetals.join('')}</g>`);
        
        // Centro de la flor - estambres
        const stamens = [];
        const stamensCount = 12;
        const stamenLength = size * 0.12;
        
        for (let i = 0; i < stamensCount; i++) {
          const angle = i * (360 / stamensCount);
          stamens.push(`
            <line x1="0" y1="0" x2="0" y2="-${stamenLength}" 
                  stroke="${centerDarkColor}" stroke-width="${size * 0.015}" 
                  transform="rotate(${angle})" />
            <circle cx="0" cy="-${stamenLength}" r="${size * 0.03}" 
                    fill="${centerColor}" transform="rotate(${angle})" />
          `);
        }
        
        // Centro central
        const center = `
          <circle cx="0" cy="0" r="${size * 0.08}" fill="${centerDarkColor}" />
          <circle cx="0" cy="0" r="${size * 0.04}" fill="${centerColor}" />
        `;
        
        // Tallo
        const stemHeight = size * 0.8;
        const stemWidth = size * 0.04;
        
        // Hojas mejoradas
        const leaves = `
          <path d="M0 ${stemHeight * 0.3} 
                   C -${size*0.35} ${stemHeight * 0.2}, -${size*0.45} ${stemHeight * 0.5}, 0 ${stemHeight * 0.6} 
                   C ${size*0.45} ${stemHeight * 0.5}, ${size*0.35} ${stemHeight * 0.2}, 0 ${stemHeight * 0.3} Z" 
                fill="#16a34a" opacity="0.85" />
          <path d="M0 ${stemHeight * 0.6} 
                   C -${size*0.3} ${stemHeight * 0.7}, -${size*0.4} ${stemHeight * 0.9}, 0 ${stemHeight * 0.95} 
                   C ${size*0.4} ${stemHeight * 0.9}, ${size*0.3} ${stemHeight * 0.7}, 0 ${stemHeight * 0.6} Z" 
                fill="#16a34a" opacity="0.85" />
        `;

        return `
          <g transform="translate(${size/2}, ${size/2})">
            ${layers.reverse().join("")}
            ${stamens.join("")}
            ${center}
            <line x1="0" y1="0" x2="0" y2="${stemHeight}" stroke="#15803d" stroke-width="${stemWidth}" stroke-linecap="round" />
            ${leaves}
          </g>
        `;
      };

      const petalFunctions = [createEllipsePetals, createPointedPetals];
      let flowerCounter = 0;

      const generateFlowerData = () => {
        flowerCounter++;
        const size = random(120, 180);

        let svgContent;
        let flowerColor = "#e11d48";
        
        if (flowerCounter % 3 === 0) {
          // Cada 3 flores → Flor amarilla detallada
          svgContent = createYellowFlower(size);
          flowerColor = "#fcd34d";
        } else {
          // Flores normales
          const petalColor = PETAL_COLORS[Math.floor(random(0, PETAL_COLORS.length))];
          const centerColor = CENTER_COLORS[Math.floor(random(0, CENTER_COLORS.length))];
          const numPetals = Math.floor(random(5, 12));
          const petalLength = size * random(0.25, 0.4);
          const petalWidth = size * random(0.1, 0.22);
          const centerSize = size * random(0.1, 0.2);
          const stemHeight = size * random(0.4, 0.6);
          const stemSway = size * random(-0.15, 0.15);
          const stemWidth = size * random(0.02, 0.04);
          const petalColorOpacity = random(0.7, 1.0);
          const selectedPetalFunc =
            petalFunctions[Math.floor(random(0, petalFunctions.length))];
          const petalsSvg = selectedPetalFunc(numPetals, petalLength, petalWidth, centerSize);

          svgContent = `
            <g transform="translate(${size/2}, ${size/2 * 0.8})" style="transform-origin: center bottom;">
              <g fill="${petalColor}" opacity="${petalColorOpacity}">${petalsSvg}</g>
              <circle cx="0" cy="0" r="${centerSize / 2}" fill="${centerColor}" />
            </g>
            <path d="M${size/2} ${size} Q${size/2 + stemSway} ${size - stemHeight / 2} ${size/2} ${size - stemHeight}"
              stroke="${STEM_COLOR}" stroke-width="${stemWidth}" fill="none" stroke-linecap="round"/>
          `;
          
          flowerColor = petalColor;
        }

        const svg = `<svg width="100%" height="100%" viewBox="0 0 ${size} ${size}" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg" style="overflow: visible;">${svgContent}</svg>`;
        return { svg, color: flowerColor, size };
      };

      const Flower = ({ flower }) => {
        const [isNew, setIsNew] = useState(true);
        const [isMounted, setIsMounted] = useState(false);

        useEffect(() => {
          const mountTimer = requestAnimationFrame(() => setIsMounted(true));
          const glowTimer = setTimeout(() => setIsNew(false), 2500);
          return () => {
            cancelAnimationFrame(mountTimer);
            clearTimeout(glowTimer);
          };
        }, []);

        const style = {
          color: flower.color,
          transition: "opacity 1s ease-out, transform 1s ease-out, filter 1.5s ease-in-out",
          opacity: isMounted ? 1 : 0,
          transform: isMounted ? "scale(1)" : "scale(0.5)",
          filter: isNew
            ? `drop-shadow(0 0 18px ${flower.color}) drop-shadow(0 0 40px ${flower.color}44)`
            : `drop-shadow(0 0 8px ${flower.color}aa)`,
          willChange: "opacity, transform, filter",
        };

        return (
          <div
            style={style}
            className="w-full h-full transform-gpu"
            dangerouslySetInnerHTML={{ __html: flower.svg }}
          />
        );
      };

      const App = () => {
        const [flowers, setFlowers] = useState([]);

        const handleGrowClick = useCallback(() => {
          const { svg, color, size } = generateFlowerData();
          const newFlower = {
            id: self.crypto.randomUUID(),
            svg,
            color,
            size,
            position: {
              top: `${random(0, 85)}%`,
              left: `${random(0, 95)}%`,
            },
          };
          setFlowers((prevFlowers) => [...prevFlowers, newFlower]);
        }, []);

        const petalSVG = (color) => `
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2 C15 5, 20 10, 12 22 C4 10, 9 5, 12 2Z" fill="${color}"/>
          </svg>
        `;

        const floatingPetals = Array.from({ length: 18 }).map((_, i) => {
          const left = `${random(0, 100)}%`;
          const duration = `${random(10, 20)}s`;
          const delay = `${random(0, 10)}s`;
          const color = PETAL_COLORS[Math.floor(random(0, PETAL_COLORS.length))];
          return (
            <div
              key={i}
              className="petal"
              style={{ left, animationDuration: duration, animationDelay: delay }}
              dangerouslySetInnerHTML={{ __html: petalSVG(color) }}
            ></div>
          );
        });

        return (
          <main className="relative min-h-screen w-full text-slate-100 flex flex-col items-center p-4 overflow-hidden">
            <header className="w-full max-w-4xl text-center py-8 z-20">
              <h1 className="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-400 via-yellow-400 to-green-400">
                Jardín Zen Digital
              </h1>
              <p className="mt-4 text-lg text-slate-800 font-medium">
                Haz clic en 'Crecer' para ver nacer una flor casi tan linda como vos.
              </p>
              <p className="mt-6 text-xl font-semibold text-transparent bg-clip-text bg-gradient-to-r from-green-600 via-pink-600 to-yellow-500 animate-pulse">
                🌸 ¡Feliz Día de la Primavera, mi amor! 🌸
              </p>
            </header>

            <div className="flex-grow w-full flex justify-center my-8 z-20">
              <button
                onClick={handleGrowClick}
                className="bg-pink-500 hover:bg-pink-600 text-white font-bold text-lg rounded-full px-8 py-3 shadow-lg shadow-pink-400/30 hover:shadow-pink-400/50 transition-all duration-300 ease-in-out transform hover:scale-105 active:scale-100"
                aria-label="Cultivar una nueva flor"
              >
                Crecer
              </button>
            </div>

            {/* Flores */}
            <div aria-hidden="true" className="absolute inset-0 w-full h-full z-10 pointer-events-none">
              {flowers.map((flower) => (
                <div
                  key={flower.id}
                  className="absolute"
                  style={{
                    top: flower.position.top,
                    left: flower.position.left,
                    width: `${flower.size}px`,
                    height: `${flower.size}px`,
                  }}
                >
                  <Flower flower={flower} />
                </div>
              ))}
            </div>

            {/* Pétalos flotando */}
            <div aria-hidden="true" className="absolute inset-0 w-full h-full z-0 overflow-hidden">
              {floatingPetals}
            </div>
          </main>
        );
      };

      const rootElement = document.getElementById("root");
      const root = ReactDOM.createRoot(rootElement);
      root.render(
        <React.StrictMode>
          <App />
        </React.StrictMode>
      );
    </script>
  </body>
</html>
